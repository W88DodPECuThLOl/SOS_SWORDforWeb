;
; IO $1Ax1 8255 PORT B TEST
;
; ・ポートB 7bit 垂直帰線期間信号のテスト
;

	org $3000

MPRINT	EQU	$1FE2
PRTHX   EQU $1FC1
LOC     EQU $201E

	CALL MPRINT
	DB 12, "IO $1AX1 8255 PORT B TEST", 13, "COUNTER:$", 0
VSYNC_LOOP:
	LD HL,$0109
	CALL LOC
	CALL VSYNC_CHECK
	JR VSYNC_LOOP

VSYNC_CHECK:
	LD A,1AH
	IN A,(01H) ; $1A01

	LD HL,LASTVSYNCFLAG
	XOR (HL)
	RET P
	XOR (HL)
	LD (HL),A
	RET M
	; LD HL,VSYNCCOUNTER
	INC HL
	INC (HL)

	;
	; カウンタ表示してみる
	;
	LD A,(VSYNCCOUNTER)
	CALL PRTHX

	RET
;
; ワーク
;
LASTVSYNCFLAG:
	DB $00
VSYNCCOUNTER:
	DW $00
